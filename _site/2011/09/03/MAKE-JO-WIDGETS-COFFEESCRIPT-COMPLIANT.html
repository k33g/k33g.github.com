<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Make the Jo widgets "Coffeescript compliant"</title>
    <meta name="author" content="k33g" />

    <!-- Homepage CSS -->
    <!--
    <link rel="stylesheet" href="http://twitter.github.io/bootstrap/assets/css/bootstrap.css">
    <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
	-->

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <link href="/bootstrap3/css/bootstrap.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="bootstrap3/js/bootstrap.min.js"></script>

    <style>
        .jumbotron {
            background-color: #b8eee9;
            border-radius: 0px;
        }
    </style>

    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
	<link rel="stylesheet" href="/css/default.min.css">


    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

</head>

<body >

<div class="jumbotron">
    <h1>K33G_ORG's Blog</h1>
    <p></p>
    <a class="label label-info" href="/">home</a>
    <a class="label label-info" href="http://twitter.com/k33g_org/">@k33g_org</a>
    <a class="label label-warning" href="http://feeds.feedburner.com/K33g_orgsBlog">rss</a>
    <a class="label label-info" href="http://k33g.github.com/all.html">all posts</a>
</div>
<div class="container">

    <div class="row">
        <div>
    <div>
        <g:plusone size="medium"></g:plusone>
        <a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="k33g_org">Tweet</a><script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
        <h1>Make the Jo widgets "Coffeescript compliant"</h1>

<h2>What is the problem ?</h2>

<p>Unfortunately for me, Jo and Coffeescript does not share the same model of Class.
I wish to do something like this (to add some behaviors to my joButton , for example)</p>

<pre><code>class Button extends joButton
    constructor:(args)-&gt;
        super args

    changeBackGroundColor:(color)-&gt;
        @setStyle({background : color})
</code></pre>

<p>... But ... Coffeescript disagrees. Indeed, the <a href="http://joapp.com/docs/#Class%20Patterns">Jo Class pattern</a> is different from the Coffeescript model :</p>

<p>A "pure" implementation of joButton in coffeescript would probably look like this (after JS comilation):</p>

<pre><code>  joButton = (function() {
    function joButton(data, classname) {
      joButton.__super__.constructor.call(this, args);
      this.enabled = true;
      if (classname) {
        this.container.classname = classname;
      }
    }
    joButton.prototype.createContainer = function() {};
    //etc. ...
    return joButton;
  })();
</code></pre>

<p>and a "daughter" class of joButton :</p>

<pre><code>  Button = (function() {
    __extends(Button, joButton);
    function Button(args) {
      Button.__super__.constructor.call(this, args);
    }
    Button.prototype.changeBackGroundColor = function(color) {
      return this.setStyle({
        background: color
      });
    };
    return Button;
  })();
</code></pre>

<p>But in reality :</p>

<p><strong>joButton implementation :</strong></p>

<pre><code>joButton = function(data, classname) {
    // call super
    joControl.apply(this, arguments);
    this.enabled = true;

    if (classname)
        this.container.className = classname;
};
joButton.extend(joControl, {
    tagName: "jobutton",

    createContainer: function() {
        //...
    },
    //etc. ...
</code></pre>

<p><strong>SubClass of joButton :</strong></p>

<pre><code>Button = function(args) {
    joButton.apply(this, args);
}
Button.extend(joButton,{
    changeBackGroundColor : function(color) {
      return this.setStyle({background: color});
    }
});
</code></pre>

<p>And it works fine, but my problem now, is that it is not really compatible with Coffeescript :(
or Coffeescript isn't compatible with that ;)</p>

<ul>
<li>I don't think that <a href="https://twitter.com/#!/balmer">@balmer</a> (Dad's Jo) is fun to rewrite Jo, even to please me.</li>
<li>I did not want to rewrite my favorite framework (I'm not even sure to happen)</li>
</ul>


<p>But, <strong>I want "class", "extends", "CoffeScript" and "Jo" !!!</strong></p>

<h2>A Solution</h2>

<p>I don't know if this is the best solution, but it works for me.</p>

<h3>In the first place</h3>

<ul>
<li>I create a "base Widget Class" that copies all members of a "Jo Widget"</li>
<li><p>I add a property <code>isCoffeeWidget</code> setted to <code>true</code> (we will see later why)</p>

<p>  class Widget
      constructor:(args)->
          for item of @joWidget
              @[item] = @joWidget[item]
          @isCoffeeWidget = true</p></li>
<li><p>Now we can write Classes that inherit <code>Widget</code> and that retrieve the properties and methods of Jo widgets :</p>

<p>  #fake joButton
  class JOButton extends Widget
      constructor:(args)->
          @joWidget = new joButton args
          super args</p>

<p>  #fake joInput
  class JOInput extends Widget
      constructor:(args)->
          @joWidget = new joInput args
          super args</p>

<p>  #and so on ...</p></li>
</ul>


<h3>In the second place</h3>

<p>If you want to do something like that : <code>myJoGroup.push myNewFakedButton</code>, it will not work.
Indeed, the <code>joContainer.push()</code> method is waiting for an <code>Object</code> or an <code>Array</code> (of <code>Objects</code>). So, we have to override <code>joContainer.push()</code> method. Write this code (duplicate the code and patch it) :</p>

<pre><code>joContainer.prototype.push = function(data) {

    /* START --- working with Coffeescript ---*/
    if (data.isCoffeeWidget) {
        this.container.appendChild(data.container);
    }
    /* END --- working with Coffeescript ---*/

    if (typeof data === 'object') {
        if (data instanceof Array) {
            // we have a list of stuff
            for (var i = 0; i &lt; data.length; i++)
                this.push(data[i]);
        }
        else if (data instanceof joView &amp;&amp; data.container !== this.container) {
            // ok, we have a single widget here
            this.container.appendChild(data.container);
        }
        else if (data instanceof HTMLElement) {
            // DOM element attached directly
            this.container.appendChild(data);
        }
    }
    else if (typeof data === 'string') {
        // shoving html directly in does work
        var o = document.createElement("div");
        o.innerHTML = data;
        this.container.appendChild(o);
    }

    return this;
}
</code></pre>

<p><strong>Remark :</strong> the only update/patch is :</p>

<pre><code>    /* START --- working with Coffeescript ---*/
    if (data.isCoffeeWidget) {
        this.container.appendChild(data.container);
    }
    /* END --- working with Coffeescript ---*/
</code></pre>

<h3>And finally ...</h3>

<p>You can do that :</p>

<pre><code>class Button extends JOButton
    constructor:(args)-&gt;
        super args

    changeBackGroundColor:(color)-&gt;
        @setStyle({background : color})

myCuteButton = new Button "Hi! I'm a cute button"

anyJoContainer.push myCuteButton

#you can push Arrays of faked widgets

myCuteButton.changeBackGroundColor "red"
</code></pre>

<h2>To conclude</h2>

<ul>
<li>If you have a better idea, feel free to contact me</li>
<li>You have no excuse not to do "Jo + Coffeescript"</li>
</ul>


<p><em>Have a nice day! <a href="https://twitter.com/#!/k33g_org">@k33g_org</a></em></p>

        <g:plusone size="medium"></g:plusone>
        <a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="k33g_org">Tweet</a><script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
    </div>
    <div class="whoring">
        <hr>
        <div id="disqus_thread"></div>
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'k33gblog'; // required: replace example with your forum shortname

                var disqus_identifier = 'Make the Jo widgets "Coffeescript compliant"';

                // The following are highly recommended additional parameters. Remove the slashes in front to use.
                // var disqus_identifier = 'unique_dynamic_id_1234';
                // var disqus_url = 'http://example.com/permalink-to-page.html';

                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

    </div>


    <div id="related">
        <h2>Related Posts</h2>
            <ul class="posts">
            
              <li><span>10 Dec 2013</span> &raquo; <a href="/2013/12/10/POLYMER-2.html">Polymer 1er contact le retour</a></li>
            
              <li><span>07 Dec 2013</span> &raquo; <a href="/2013/12/07/POLYMER-1.html">Polymer 1er contact</a></li>
            
              <li><span>29 Nov 2013</span> &raquo; <a href="/2013/11/29/BBOM.html">Le modèle objet de Backbone</a></li>
            
        </ul>
    </div>
</div>
    </div>

    <div class="row">
        <h3>A voir : Les GROS tutos Play!> 1 & 2 !, Backbone</h3>
        <ul>
            <li>
                <a href="http://3monkeys.github.com/play.rules/livre.play.deux.web/play2.rules.return.html">
                    Play!► 2 en douceur •
                </a>
                <a href="http://3monkeys.github.com/play.rules/livre.play.un.web/play.rules.one.html">
                    Apprendre Play!► 1 •
                </a>
                <a href="http://3monkeys.github.com/play.rules/">
                    Versions epub & pdf
                </a>
            </li>
            <li>
                <a href="http://k33g.github.io/backbone.en.douceur/">
                    Backbone.js "en douceur" •
                </a>
                <a href="http://k33g.github.io/backbone.en.douceur/backbone.en.douceur.20121220.pdf"><b>LE</b> pdf</a>
            </li>
            <li>
                A venir : Golo "dans tous les sens" ♥
            </li>
        </ul>
    </div>
    <hr>

</div>



<!-- Google Analytics -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11383603-5']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- Google Analytics end -->

</body>
</html>